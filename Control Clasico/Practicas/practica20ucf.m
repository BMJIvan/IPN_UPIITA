 clc
clear all
close all
  VECA=[0,.67,1.18,1.58,1.9,2.2,2.45,2.69,2.87,2.97,3.04,3,2.86,2.45,1.77,.74,.14,-.17,-.29,-.30,-.25,-.15,.02,.19,.33,.43,.41,.08,-.25,-.32,-.08,.07,.32,.53,.73,.86,.94,.9,.84,.68,.51,.35,.21,.06,-.09,-.19,-.34,-.45,-.5,-.53,-.52,-.43,-.3,-.04];
  VECA2=[-.04,-.3,-.43,-.52,-.53,-.5,-.45,-.34,-.19,-.09,.06,.21,.35,.51,.68,.84,.14,-.17,-.29,-.30,-.25,-.15,.07,-.08,-.32,-.25,.08,.41,.43,.33,.19,.02,.32,.53,.73,.86,.94,.9,.74,1.77,2.45,2.86,3,3.04,2.97,2.87,2.69,2.45,2.2,1.9,1.58,1.18,.67,0];
  %0 a 27=28
  %26 a 0=27=55
  
  xa=0:27;
  xb=25:-1:0;
  xx=[xa,xb];
  yy=VECA;
  zz=VECA2;
 
dt=.01;
t=0:dt:10;

m1=1;
m2=m1;
m3=m2;
b=1;
g=9.81;

Kp=[20;20;20];
Kd=[30,0;0,30];
Ki=[30,0;0,30];

F=[0;0;0];
%o=0:3/1001:3;
%a=o.*sind((0:360/1001:360)*5);
%b=o.*cosd((0:360/1001:360)*5);

Xp=[0;0;0];
X=[0;0;0];
%SP=[a;b;o.*ones(1,length(t)+1)];
SP=[xx;yy;yy];
%SP=[1;0;1];
E=[0;0;0];
kp=100;
kd=50;
ki=100;


a=1;
b=1;

for i=1:length(t)-1

if b>=19
b=1;
a=a+1;
end

if a>=54
a=54;
end

M=[m1+m2+m3,0,0;0,m2+m3,0;0,0,m3];
C=[0,0,0;0,0,0;0,0,0];
G=[0;0;-g];

E(:,i+1)=SP(:,a)-X(:,i);
Ed(:,i)=(E(:,i+1)-E(:,i))/dt;
Ei(:,i)=sum(E*dt,2);

F=kp*E(:,i+1)+kd*Ed(:,i)+ki*Ei(:,i);
Xpp(:,i)=inv(M)*(F-C*Xp(:,i)+G);
Xp(:,i+1)=sum(Xpp*dt,2);
X(:,i+1)=sum(Xp*dt,2);
b=b+1;
end

hold on
x=[0 1 1 1]*X(1,1001);
y=[0 0 1 1]*X(2,1001);
z=[0 0 0 1]*X(3,1001);
plot3(x,y,z)
plot3(X(1,:),X(2,:),X(3,:))
axis([-10 10 -10 10 -10 10])


figure,
hold on
for i=1:length(t)-1
    cla
x=[0 1 1 1]*X(1,i);
y=[0 0 1 1]*X(2,i);
z=[0 0 0 1]*X(3,i);
plot3(x,y,z)
plot3(X(1,:),X(2,:),X(3,:))
    
    %plot3([x0 x1 x1 x1],[y0 y0 y0 y1],[z0 z0 z0 z1],'o')
    
    axis([-8 42 -6 6 -6 6])
    pause(dt)
end

hold off
