	PROCESSOR	P16F887
	INCLUDE		<P16F887.INC>

	__CONFIG _CONFIG1, (_INTRC_OSC_NOCLKOUT & _WDT_OFF & _PWRTE_OFF & _MCLRE_OFF & _CP_OFF & _CPD_OFF & _BOR_OFF & _IESO_OFF & _FCMEN_OFF & _LVP_OFF & _DEBUG_OFF)
	__CONFIG _CONFIG2, (_WRT_OFF & _BOR40V)
	
XM		EQU			0x20
XC		EQU			0x21
XD		EQU			0x22
XU		EQU			0x23
CT		EQU			0x24
CX		EQU			0x25
PARO	EQU			0x26
		ORG			0x00
		BANKSEL		ANSEL
		CLRF		ANSEL
		CLRF		ANSELH
		BANKSEL		TRISA
		CLRF		TRISA
		CLRF		TRISB
		CLRF		TRISC
		MOVLW		0xFF
		MOVWF		TRISD
		CLRF		TRISE
		MOVLW		0xD6
		MOVWF		OPTION_REG
		BANKSEL		PORTA
	

	
		CLRF		XM
		CLRF		XC
		CLRF		XD
		CLRF		XU
C_M
C_C
C_D
C_U
		MOVLW		0x3E
		MOVWF		CX

C_P		
		MOVF		XU,W
		CALL		T7S
		MOVWF		PORTB
		MOVLW		0x01
		MOVWF		PORTC
		CALL		R4MS
		
		MOVF		XD,W
		CALL		T7S
		MOVWF		PORTB
		MOVLW		0x02
		MOVWF		PORTC
		CALL		R4MS
		
		MOVF		XC,W
		CALL		T7S
		MOVWF		PORTB
		MOVLW		0x04
		MOVWF		PORTC
		CALL		R4MS
		
		MOVF		XM,W
		CALL		T7S
		MOVWF		PORTB
		MOVLW		0x08
		MOVWF		PORTC
		CALL		R4MS
		DECFSZ		CX,F		
		GOTO		C_P
	
		CALL		RMS
		CALL		PAR
SIG		INCF		XU,F
 		MOVLW		0x0A
		SUBWF		XU,W
		BTFSS		STATUS,Z
		GOTO		C_U	
		
		CLRF		XU
		INCF		XD,F
 		MOVLW		0x06
		SUBWF		XD,W
		BTFSS		STATUS,Z
		GOTO C_D
	
		CLRF		XD
		INCF		XC,F
 		MOVLW		0x0A
		SUBWF		XC,W
		BTFSS		STATUS,Z
		GOTO C_C	

		CLRF		XC
		INCF		XM,F
 		MOVLW		0x06
		SUBWF		XM,W
		BTFSS		STATUS,Z
		GOTO C_M

		CLRF		XU
		CLRF		XD
		CLRF		XC
		CLRF		XM
		GOTO C_M
PAUSA
		MOVF		XU,W
		CALL		T7S
		MOVWF		PORTB
		MOVLW		0x01
		MOVWF		PORTC
		CALL		R4MS
		
		MOVF		XD,W
		CALL		T7S
		MOVWF		PORTB
		MOVLW		0x02
		MOVWF		PORTC
		CALL		R4MS
		
		MOVF		XC,W
		CALL		T7S
		MOVWF		PORTB
		MOVLW		0x04
		MOVWF		PORTC
		CALL		R4MS

		MOVF		XM,W
		CALL		T7S
		MOVWF		PORTB
		MOVLW		0x08
		MOVWF		PORTC
		CALL		R4MS
		GOTO	PAUSA
	
T7S
		ADDWF		PCL,F
		RETLW		0x3F
		RETLW		0x06
		RETLW		0x5B
		RETLW		0x4F
		RETLW		0x66
		RETLW		0x6D
		RETLW		0x7D
		RETLW		0x07
		RETLW		0x7F
		RETLW		0X67
	
R4MS
		MOVLW		0x1D
		MOVWF		CT
REP2    CLRF		TMR0
E64I	BTFSS		TMR0,0
		GOTO		E64I
		DECFSZ		CT,F
		GOTO		REP2
		RETURN

RMS
		MOVLW		0x1A
		MOVWF		CT
RE  	CLRF		TMR0
E6		BTFSS		TMR0,0
		GOTO		E6	
		DECFSZ		CT,F
		GOTO		RE
		RETURN


COM
		MOVLW		0x07
		SUBWF		XM,W
		BTFSS		STATUS,Z
		RETURN
		MOVLW		0x05
		SUBWF		XC,W
		BTFSS		STATUS,Z
		RETURN
		MOVLW		0x03
		SUBWF		XD,W
		BTFSS		STATUS,Z
		RETURN
		MOVLW		0x01
		SUBWF		XU,W
		BTFSS		STATUS,Z
		RETURN
		GOTO	PAUSA
		RETURN

PAR		
		MOVLW		0x01
		SUBWF		PORTD,W
		BTFSS		STATUS,Z
		RETURN
		GOTO	PAUSA
		RETURN
AVA		
		MOVF		PORTD,W
		BTFSS		STATUS,Z
		RETURN
		GOTO	SIG
		RETURN
BORR	
		
		CLRF	XU
		CLRF	XD
		CLRF	XC
		CLRF	XM

END