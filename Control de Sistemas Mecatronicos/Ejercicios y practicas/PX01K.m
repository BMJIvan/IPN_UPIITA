clc
clear all
close all

m1=2;
m2=1;
m3=1;
v1=1;
v2=1;
v3=1;
v4=1;
v5=1;
k=2;

A=[0,1,0,0,0,0;
  -k/m1,(-v2-v4-v1)/m1,k/m1,v2/m1,0,v4/m1
  0,0,0,1,0,0 
  k/m2,v2/m2,-k/m2,(-v2-v5)/m2,0,v5/m2
  0,0,0,0,0,1
  0,v4/m3,0,v5/m3,0,(-v4-v3-v5)/m3
    ];
B=[0;0;0;1/m2;0;0];
C=[0,0,0,1,0,0];

n=size(A,1);

Lb=size(B,2);
Con=zeros(n,n*Lb);
for i=1:n
    Con(:,(1+((i-1)*Lb)):(Lb+((i-1)*Lb)))=A^(i-1)*B;
end
r=rank(Con);
Q=Con;
Q(:,6)=[0;0;1;0;-1;0];
Qinv=inv(Q);

An=Qinv*A*Q;
Bn=Qinv*B;
I=eye(r);
A=An(1:r,1:r);
B=Bn(1:r);
syms k1 k2 k3 k4 k5 s

K=[k1,k2,k3,k4,k5];
L=size(B,1);
I=eye(L);

MD1=expand(det(s*I-(A-B*K)));
MD2=expand((s-(-2))*(s-(-2))*(s-(-2))*(s-(-2))*(s-(-2)));

pol=MD1;
a=sym(zeros(1,L));
a(L)=subs(pol,s,0);
npol=pol-a(L);

for k=1:L-1
nnpol=npol;
cont=L-k;
for i=L:-1:1
    if i==cont
        nnpol=subs(nnpol,s^i,1);
    else
        nnpol=subs(nnpol,s^i,0);
    end
end
a(k)=nnpol;
end
Ma1=a;

pol=MD2;
a=zeros(1,L);
a(L)=subs(pol,s,0);
npol=pol-a(L);
b=sym(zeros(L,1));
for k=1:L-1
nnpol=npol;
cont=L-k;
for i=L:-1:1
    if i==cont
        nnpol=subs(nnpol,s^i,1);
    else
        nnpol=subs(nnpol,s^i,0);
    end
end
a(k)=nnpol;
end
Ma2=a;

% ec=[1,0,0,0,0
%     (29273397577908201)/4503599627370496,1,1/9007199254740992,0,1/72057594037927936
%     (36761867406618586848628586840077)/2535301200456458802993406410752,(468374361246531195)/72057594037927936,(40564819207303361114092825739249)/40564819207303340847894502572032,- (13)/144115188075855872,(9007199254740969)/324518553658426726783156020576256
%     (11417981541647695924064903293924251285780955137)/713623846352979940529142984724747568191373312,(588189878505897325401762699411727)/40564819207303340847894502572032,(74216880020709885768261340361795740886926098431)/11417981541647679048466287755595961091061972992,(649037107316853516616706824339675)/649037107316853453566312041152512,(20282409603651661416747996545037)/182687704666362864775460604089535377456991567872
%     (28544953854119217903575323040691851872297812025)/5708990770823839524233143877797980545530986496,(182687704666363091684918044943060990228577648635)/11417981541647679048466287755595961091061972992,(331121464707782165062872649968966972277738438653)/22835963083295358096932575511191922182123945984,(649037107316853516616706824339675)/649037107316853453566312041152512,(20282409603651661416747996545037)/182687704666362864775460604089535377456991567872];

ec=zeros(r,r);
cons=subs(Ma1,{k1,k2,k3,k4,k5},{0,0,0,0,0});

Ma1=Ma1-cons;
for i=1:r
    MM=Ma1;
    vec=zeros(1,5);
    vec(i)=1;
tt=subs(MM,{k1 k2 k3 k4 k5},{vec});
ec(:,i)=tt';
end

Ma2=Ma2-cons;
detp=det(ec);
MeDir=zeros(1,L);
ecpn=zeros(5,5);
for n=1:5
    ecpn=ec;
    ecpn(:,n)=Ma2;
   MeDir(n)=det(ecpn)/detp; 
end
disp(MeDir)
 
Kr=[MeDir,0];
K=Kr*Qinv;

m1=2;
m2=1;
m3=1;
v1=1;
v2=1;
v3=1;
v4=1;
v5=1;
k=2;

A=[0,1,0,0,0,0;
  -k/m1,(-v2-v4-v1)/m1,k/m1,v2/m1,0,v4/m1
  0,0,0,1,0,0 
  k/m2,v2/m2,-k/m2,(-v2-v5)/m2,0,v5/m2
  0,0,0,0,0,1
  0,v4/m3,0,v5/m3,0,(-v4-v3-v5)/m3
    ];
B=[0;0;0;1/m2;0;0];

eig(A-B*K)